# スタンプ画面 設計書

## 📋 画面概要

### 目的
ユーザーが獲得したスタンプを視覚的に確認し、習慣形成の成果を実感できる画面。

### 機能概要
- 獲得したスタンプの視覚的表示（スタンプカード）
- スタンプ統計情報の表示（総数、ストリーク、週次・月次統計）
- 複数カード対応（12枚単位での自動カード生成）
- 最近のスタンプ履歴表示
- ダッシュボードからの遷移対応

## 🎯 ユーザー体験

### ユーザーストーリー
```
ユーザーとして、
自分が獲得したスタンプを楽しく確認したい。
そうすることで、習慣継続のモチベーションを維持できる。
```

### 主要なユースケース
1. **成果確認**: 獲得したスタンプの視覚的確認
2. **進捗実感**: 統計情報による成長の実感
3. **コレクション感覚**: スタンプカードの収集楽しさ
4. **継続モチベーション**: 視覚的成果による継続意欲

## 🏗 UI構造

### レイアウト構成
```
┌─────────────────────────┐
│      ヘッダー           │
│   「獲得スタンプ」       │
├─────────────────────────┤
│   スタンプカードエリア   │
│  ┌─────────────────┐   │
│  │  [<] カード1 [>] │   │
│  │ ┌──┬──┬──┬──┐   │   │
│  │ │🌟│🌟│🌟│○ │   │   │
│  │ ├──┼──┼──┼──┤   │   │
│  │ │🌟│🌟│○ │○ │   │   │
│  │ ├──┼──┼──┼──┤   │   │
│  │ │○ │○ │○ │○ │   │   │
│  │ └──┴──┴──┴──┘   │   │
│  │ プログレス: 5/12   │   │
│  └─────────────────┘   │
├─────────────────────────┤
│      統計情報           │
│  ┌─────┬─────┐       │
│  │ 15  │  7  │       │
│  │総スタ│現スト│       │
│  │ンプ │リーク│       │
│  └─────┴─────┘       │
│  ┌─────┬─────┐       │
│  │  8  │ 12  │       │
│  │今週 │今月 │       │
│  │スタ │スタ │       │
│  └─────┴─────┘       │
├─────────────────────────┤
│   最近のスタンプ履歴     │
│  ┌─────────────────┐   │
│  │🌟 2025/01/15     │   │
│  │   毎日ランニング  │   │
│  └─────────────────┘   │
│  ┌─────────────────┐   │
│  │🌟 2025/01/14     │   │
│  │   英語学習       │   │
│  └─────────────────┘   │
└─────────────────────────┘
```

### コンポーネント構成

#### 1. スタンプカードコレクション
- **複数カード管理**: 12枚単位での自動カード生成
- **カード間ナビゲーション**: 左右矢印でカード切り替え
- **進捗表示**: 各カードの埋まり具合を表示
- **完成カード演出**: 12枚達成時の特別アニメーション

#### 2. スタンプカード（個別）
- **3x4グリッドレイアウト**: 12個のスタンプスロット
- **スタンプ表示**: 
  - 獲得済み: 日付付きカラフルなスタンプ
  - 未獲得: 空のプレースホルダー
- **気分表示**: 各スタンプに気分絵文字を表示
- **日付表示**: スタンプ獲得日を表示

#### 3. 統計情報カード
- **総スタンプ数**: 累計獲得数
- **現在のストリーク**: 連続記録日数
- **今週のスタンプ**: 週次統計
- **今月のスタンプ**: 月次統計

#### 4. 最近のスタンプ履歴
- **時系列表示**: 最新から順に表示
- **詳細情報**: 日付、目標名、メモを表示
- **スタンプタイプ**: アイコンでタイプ識別

## 🎨 デザイン仕様

### スタンプカードデザイン
```
┌─────────────────────┐
│    Card 1 of 2     │
│ ┌──┬──┬──┬──┐     │
│ │15│16│17│○ │     │
│ │😊│😆│💪│  │     │
│ ├──┼──┼──┼──┤     │
│ │11│12│13│14│     │
│ │🎯│✨│😴│🌟│     │
│ ├──┼──┼──┼──┤     │
│ │ 7│ 8│ 9│10│     │
│ │💪│😊│🎯│✨│     │
│ └──┴──┴──┴──┘     │
│     Progress       │
│ ████████░░░░ 8/12  │
└─────────────────────┘
```

### カラーパレット
- **スタンプ色**: 気分に応じた動的カラー
  - 嬉しい: #4ECDC4
  - 興奮: #FF6B6B  
  - やる気: #45B7D1
  - 集中: #96CEB4
  - 爽快: #FECA57
- **プログレスバー**: #007AFF
- **背景**: システム背景色対応

### アニメーション効果
- **スタンプ出現**: スケール + 回転アニメーション
- **カード切り替え**: スライドトランジション
- **完成祝福**: パーティクル + バウンス効果

## ⚙️ 機能仕様

### 状態管理
```typescript
const [stats, setStats] = useState<StampStats>({
  totalStamps: 0,
  currentStreak: 0,
  thisWeekStamps: 0,
  thisMonthStamps: 0,
});
const [stamps, setStamps] = useState<StampModel[]>([]);
const [loading, setLoading] = useState(true);
```

### データフロー
```
Database
├── stamps: StampModel[]        // 全スタンプデータ
├── goals: GoalModel[]          // 関連目標データ
└── useStamps: Hook            // スタンプ統計フック
    ├── getTotalStamps()       // 総数取得
    ├── getCurrentStreak()     // ストリーク計算
    ├── getStampsThisWeek()    // 週次統計
    └── getStampsThisMonth()   // 月次統計
```

### スタンプデータモデル
```typescript
interface StampModel {
  id: string;
  goalId: string;          // 関連目標ID
  date: Date;              // スタンプ日付
  stampedAt: Date;         // 作成日時
  stampType: string;       // スタンプタイプ
  mood: string;           // 気分状態
  difficulty: number;      // 難易度 (1-5)
  note: string;           // メモ
}
```

## 🔧 技術仕様

### 主要コンポーネント

#### `StampCardCollection`
- **目的**: 複数スタンプカードの管理・表示
- **機能**:
  - 12枚単位での自動カード分割
  - カード間ナビゲーション
  - 進捗計算・表示
  - 完成カード検出・演出

#### `StampCard` 
- **目的**: 個別スタンプカードの表示
- **機能**:
  - 3x4グリッドレイアウト
  - スタンプの視覚的表示
  - 空スロットのプレースホルダー
  - 進捗バー表示

#### `StampAnimation`
- **目的**: スタンプ獲得時のアニメーション
- **機能**:
  - フルスクリーン演出
  - パーティクルエフェクト
  - 完了後のコールバック
  - 気分に応じたカスタマイズ

### 主要関数

#### `loadStampData()`
- **目的**: スタンプデータの読み込み
- **処理**:
  1. 統計情報の並列取得
  2. データベースからスタンプ取得
  3. 時系列ソート
  4. UI状態の更新

#### `formatDate()`
- **目的**: 日本語形式での日付表示
- **処理**: Intl.DateTimeFormatによる地域化

#### `renderStampItem()`
- **目的**: スタンプ履歴アイテムの表示
- **処理**: カード形式でのスタンプ詳細表示

### パフォーマンス最適化
- **useFocusEffect**: 画面フォーカス時のデータ更新
- **メモ化**: 重複計算の防止
- **条件付きレンダリング**: 必要な要素のみ表示

## 📱 インタラクション

### ナビゲーション
- **カード切り替え**: 左右スワイプまたはボタンタップ
- **スタンプタップ**: 詳細情報表示（将来実装）
- **統計カードタップ**: 詳細統計画面（将来実装）

### 視覚的フィードバック
- **ローディング**: スケルトンローダー
- **空状態**: 励ましメッセージ
- **完成カード**: 祝福アニメーション

## 🔄 画面遷移

### 遷移元
- **ダッシュボード**: 完了ボタン → スタンプアニメーション → スタンプ画面
- **タブナビゲーション**: スタンプタブ直接アクセス

### 遷移先
- **ダッシュボード**: タブナビゲーション
- **目標作成**: 新規目標作成（将来実装）

## 🚀 実装ファイル

### 主要ファイル
- **メイン画面**: `app/(tabs)/stamps.tsx`
- **スタンプカード**: `src/components/StampCard.tsx`
- **カードコレクション**: `src/components/StampCardCollection.tsx`
- **アニメーション**: `src/components/StampAnimation.tsx`
- **データサービス**: `src/services/StampService.ts`
- **統計フック**: `src/hooks/useStamps.ts`
- **データ型**: `src/types/Stamp.ts`
- **サンプルデータ**: `src/data/stamps.ts`

### データベース
- **モデル**: `src/database/models/Stamp.ts`
- **ローダー**: `src/services/StampDataLoader.ts`

## 📋 実装済み機能

### ✅ 完了済み
- [x] スタンプ画面の基本レイアウト
- [x] スタンプカードコンポーネント
- [x] 3x4グリッドスタンプ表示
- [x] 複数カード対応
- [x] カード間ナビゲーション
- [x] 統計情報表示
- [x] 最近のスタンプ履歴
- [x] ダッシュボード連携
- [x] スタンプ作成機能
- [x] アニメーション演出
- [x] データベース統合
- [x] フォーカス時データ更新

### 🚧 今後の拡張予定
- [ ] スタンプ詳細表示
- [ ] フィルター・検索機能
- [ ] エクスポート機能
- [ ] 共有機能
- [ ] 統計詳細画面

## 🧪 テスト観点

### 単体テスト
- [ ] スタンプカード表示ロジック
- [ ] 統計計算の正確性
- [ ] データソート・フィルタリング
- [ ] 空状態の処理

### 統合テスト
- [ ] データベース連携
- [ ] ダッシュボード遷移
- [ ] アニメーション統合
- [ ] 複数カード生成

### UIテスト
- [ ] カード切り替え操作
- [ ] レスポンシブ表示
- [ ] ライト・ダークモード対応
- [ ] アクセシビリティ

---

*📝 Created: 2025-01-15 | 🔄 Last Updated: 2025-01-15*