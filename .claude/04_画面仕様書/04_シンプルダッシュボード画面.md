# シンプルダッシュボード画面 設計書

## 📋 画面概要

### 目的
ユーザーが現在の習慣形成の進捗状況を一目で把握し、今日のアクションを実行できるメイン画面。

### 機能概要
- 今日の進捗状況の確認
- アクティブな目標一覧の表示
- スタンプ機能（習慣実行記録）
- 統計情報の表示（総スタンプ数、ストリーク等）
- プルダウンリフレッシュによるデータ更新

## 🎯 ユーザー体験

### ユーザーストーリー
```
ユーザーとして、
今日やるべきことと進捗状況を素早く確認したい。
そうすることで、習慣を継続するモチベーションを維持できる。
```

### 主要なユースケース
1. **今日の確認**: 今日完了すべき習慣の確認
2. **進捗記録**: 習慣実行時のスタンプ記録
3. **成果確認**: 累計統計や連続記録の確認
4. **モチベーション維持**: トレーナーからの応援メッセージ

## 🏗 UI構造

### レイアウト構成
```
┌─────────────────────────┐
│        ヘッダー          │
│   トレーナー挨拶         │
├─────────────────────────┤
│                         │
│      統計情報セクション    │
│  ┌─────┬─────┬─────┐   │
│  │総スタ│ストリ│最高ス│   │
│  │ンプ数│ーク │トリーク│   │
│  └─────┴─────┴─────┘   │
│                         │
│      今日の目標セクション  │
│  ┌─────────────────┐   │
│  │ 目標A              │   │
│  │ ・説明             │   │
│  │ [スタンプボタン] ✓  │   │
│  └─────────────────┘   │
│  ┌─────────────────┐   │
│  │ 目標B              │   │
│  │ ・説明             │   │
│  │ [スタンプボタン] ○  │   │
│  └─────────────────┘   │
│                         │
│      アクションエリア     │
│  ┌─────────────────┐   │
│  │ [新しい目標を追加]   │   │
│  │ [トレーナー変更]     │   │
│  └─────────────────┘   │
└─────────────────────────┘
```

### コンポーネント構成

#### 1. ヘッダー・挨拶エリア
- **トレーナー表示**: 現在選択中のトレーナー情報
- **挨拶メッセージ**: 時間帯に応じた挨拶
- **日付表示**: 今日の日付

#### 2. 統計情報カード
- **総スタンプ数**: 累計で獲得したスタンプ数
- **現在のストリーク**: 連続記録日数
- **最高ストリーク**: 過去最高の連続記録
- **アクティブ目標数**: 現在進行中の目標数

#### 3. 今日の目標リスト
- **目標カード**: 各目標の表示
  - 目標名
  - 説明文
  - 今日の完了状態
  - スタンプボタン
- **完了状態インジケーター**: ✓（完了）/ ○（未完了）

#### 4. アクションボタン
- **新しい目標を追加**: ゴール作成画面への遷移
- **トレーナー変更**: トレーナー選択画面への遷移

#### 5. リフレッシュ機能
- **プルダウンリフレッシュ**: 画面を下に引っ張ってデータ更新

## 🎨 デザイン仕様

### カラーパレット
- **プライマリ**: #007AFF（メインアクション）
- **成功**: #34C759（完了状態）
- **警告**: #FF9500（注意・重要）
- **グレー**: #8E8E93（セカンダリテキスト）
- **背景**: システム背景色（ライト/ダークモード対応）

### 統計情報カードデザイン
```
┌─────────────────┐
│   📊 統計情報    │
├─────────────────┤
│ 総スタンプ数      │
│     1,234      │
├─────────────────┤
│ 現在ストリーク    │
│     7日        │
├─────────────────┤
│ 最高ストリーク    │
│     23日       │
├─────────────────┤
│ アクティブ目標    │
│     5個        │
└─────────────────┘
```

### 目標カードデザイン
```
┌─────────────────────┐
│ 💪 毎日30分の運動    │
│ 健康維持のため...    │
│                     │
│ [今日のスタンプ] ✓   │
└─────────────────────┘
```

## ⚙️ 機能仕様

### 状態管理
```typescript
const [refreshing, setRefreshing] = useState(false);
const [todayStamps, setTodayStamps] = useState<Set<string>>(new Set());
const [statistics, setStatistics] = useState({
  totalStamps: 0,
  currentStreak: 0,
  bestStreak: 0,
  activeGoals: 0
});
```

### データフロー
```
AppContext
├── goals: GoalModel[]           // アクティブな目標一覧
├── selectedTrainer: TrainerModel // 現在のトレーナー
├── audioService: AudioService   // 音声サービス
├── isLoading: boolean          // ローディング状態
└── refreshData()              // データ更新関数
```

### パフォーマンス最適化
```typescript
// メモ化による最適化
const memoizedStatistics = useMemoizedValue(() => statistics, [statistics]);

// 安定したコールバック
const loadDashboardData = useStableCallback(async () => {
  // データ読み込み処理
});

// キャッシュ活用
const cacheKey = 'dashboard_data';
const cached = MemoryOptimizer.getCache(cacheKey);
```

## 🔧 技術仕様

### 主要関数

#### `loadDashboardData()`
- **目的**: ダッシュボードデータの読み込み
- **処理**:
  1. キャッシュデータの確認
  2. 統計情報の計算
  3. 今日のスタンプ状態の取得
  4. パフォーマンス測定

#### `loadStatistics()`
- **目的**: 統計情報の計算・取得
- **処理**:
  1. 全目標の集計
  2. ストリーク計算
  3. アクティブ目標数の計算

#### `loadTodayStamps()`
- **目的**: 今日のスタンプ状態を取得
- **処理**:
  1. 今日の日付でフィルタリング
  2. 完了済み目標IDのSet作成

#### `handleStampPress(goal: GoalModel)`
- **目的**: スタンプボタンのタップ処理
- **処理**:
  1. 今日の完了状態確認
  2. スタンプの追加/削除
  3. 統計情報の更新
  4. ハプティックフィードバック
  5. 音声フィードバック（完了時）

#### `handleRefresh()`
- **目的**: プルダウンリフレッシュの処理
- **処理**:
  1. リフレッシュ状態の更新
  2. キャッシュクリア
  3. データ再読み込み
  4. UI状態のリセット

### エラーハンドリング
- **データ読み込みエラー**: ユーザーフレンドリーなエラー表示
- **スタンプ処理エラー**: 操作の巻き戻しとエラー通知
- **ネットワークエラー**: オフライン対応とリトライ機能

## 📱 インタラクション

### タップインタラクション
- **スタンプボタン**: 
  - 未完了 → 完了: 緑色のチェックマーク表示
  - 完了 → 未完了: グレーの円表示
- **目標カード**: 詳細画面への遷移（将来実装）
- **統計カード**: 詳細統計画面への遷移（将来実装）

### 視覚的フィードバック
- **スタンプ完了**: アニメーション効果
- **ローディング**: インジケーター表示
- **リフレッシュ**: 回転アニメーション

### 音声フィードバック
- **目標完了**: トレーナーからの祝福メッセージ
- **全目標完了**: 特別な応援メッセージ
- **ストリーク達成**: マイルストーン祝福

### ハプティックフィードバック
- **スタンプタップ**: 軽い振動
- **目標完了**: 成功の振動パターン
- **ボタンタップ**: 標準タップフィードバック

## 🚀 パフォーマンス

### メモリ最適化
- **MemoryOptimizer**: データキャッシュ管理
- **PerformanceMonitor**: 処理時間測定
- **useMemoizedValue**: 不要な再計算防止
- **useStableCallback**: 不要な再レンダリング防止

### データキャッシュ
```typescript
const cacheStrategy = {
  'dashboard_data': {
    expiry: 5 * 60 * 1000, // 5分
    keys: ['statistics', 'todayStamps']
  },
  'statistics_${goalsLength}': {
    expiry: 10 * 60 * 1000, // 10分
    dependency: 'goalsLength'
  }
}
```

### レンダリング最適化
- **条件付きレンダリング**: 必要なコンポーネントのみ表示
- **リスト最適化**: FlatListでの仮想化（将来実装）
- **画像最適化**: 遅延読み込み

## 🔄 ライフサイクル

### マウント時
1. AppContextからデータ取得
2. ダッシュボードデータの読み込み
3. キャッシュデータの確認・適用

### 更新時
1. 目標やトレーナーの変更検知
2. 関連データの再読み込み
3. UIの再レンダリング

### アンマウント時
1. 購読イベントの解除
2. メモリリークの防止

## 🚀 実装ファイル

- **メインコンポーネント**: `src/screens/SimpleDashboard.tsx`
- **スタイル**: コンポーネント内StyleSheet
- **パフォーマンス**: `src/utils/PerformanceOptimizer.ts`
- **データモデル**: `src/database/models/Goal.ts`

## 📋 テスト観点

### 単体テスト
- [ ] 統計情報の計算
- [ ] 今日のスタンプ判定
- [ ] キャッシュ機能
- [ ] エラーハンドリング

### 統合テスト
- [ ] データ読み込みフロー
- [ ] スタンプ機能
- [ ] リフレッシュ機能
- [ ] 音声・ハプティックフィードバック

### UIテスト
- [ ] 目標一覧の表示
- [ ] 統計情報の表示
- [ ] スタンプボタンの状態変化
- [ ] プルダウンリフレッシュ

### パフォーマンステスト
- [ ] 大量データでの動作
- [ ] メモリ使用量
- [ ] レンダリング速度
- [ ] キャッシュ効率

### アクセシビリティテスト
- [ ] スクリーンリーダー対応
- [ ] 色覚異常対応
- [ ] 文字サイズ対応
- [ ] タッチターゲットサイズ

---

*📝 Created: 2025-08-20 | 🔄 Last Updated: 2025-08-20*