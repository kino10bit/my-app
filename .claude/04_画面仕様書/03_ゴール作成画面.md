# ゴール作成画面 設計書

## 📋 画面概要

### 目的
ユーザーが新しい習慣形成目標を簡単に作成・設定する画面。シンプルな2ステッププロセスで効率的な目標作成を実現。

### 機能概要
- 目標の基本情報設定（ステップ1）
- リマインダー時間設定（ステップ2）
- 2ステップで目標作成完了

## 🎯 ユーザー体験

### ユーザーストーリー
```
ユーザーとして、
簡単で迅速に習慣目標を設定したい。
そうすることで、面倒な手続きなく習慣形成を始められる。
```

### 主要なユースケース
1. **新規目標作成**: 基本情報の簡単入力
2. **リマインダー設定**: 通知時間の選択
3. **目標作成完了**: 2ステップで即座にスタート

## 🏗 UI構造

### レイアウト構成

#### ステップ1: 基本情報入力
```
┌─────────────────────────┐
│        ヘッダー          │
│     ステップ 1 / 2       │
├─────────────────────────┤
│                         │
│      基本情報セクション    │
│  ┌─────────────────┐   │
│  │ タイトル入力       │   │
│  │ 説明入力          │   │
│  └─────────────────┘   │
│                         │
├─────────────────────────┤
│       [次へ]ボタン        │
└─────────────────────────┘
```

#### ステップ2: リマインダー設定
```
┌─────────────────────────┐
│        ヘッダー          │
│     ステップ 2 / 2       │
├─────────────────────────┤
│                         │
│   リマインダー設定セクション │
│  ┌─────────────────┐   │
│  │ リマインダー有効/無効│   │
│  │ 時刻選択 (6:00-22:30)│   │
│  │ 30分間隔で選択可能  │   │
│  └─────────────────┘   │
│                         │
├─────────────────────────┤
│     [目標を作成]ボタン     │
└─────────────────────────┘
```

### セクション構成

#### 1. ヘッダー
- **タイトル**: 「新しい目標を作成」
- **ステップ表示**: 「ステップ 1 / 2」または「ステップ 2 / 2」
- **戻るボタン**: 前画面への戻り機能

#### 2. ステップ1: 基本情報セクション
- **タイトル入力**: 目標名（必須、例: "毎日運動する"）
- **説明入力**: 目標の詳細（必須、例: "健康のために毎日30分の運動を心がけます"）

#### 3. ステップ2: リマインダー設定セクション
- **リマインダー有効/無効**: カスタムトグルスイッチ
- **時刻選択**: 
  - 6:00から22:30まで30分間隔で選択可能
  - スクロール可能なピッカー形式
  - リマインダー有効時のみ選択可能

## 🎨 デザイン仕様

### カラーパレット
- **プライマリ**: #007AFF（iOS標準ブルー）
- **セカンダリ**: #34C759（成功・完了）
- **アクセント**: #FF9500（警告・重要）
- **背景**: システム背景色（ライト/ダークモード対応）
- **テキスト**: システムテキスト色

### コンポーネントライブラリ（NativeBase）
- `Box`: レイアウトコンテナ
- `VStack/HStack`: 縦横配置
- `Input/TextArea`: テキスト入力
- `Select`: ドロップダウン選択
- `Slider`: 数値スライダー
- `Switch`: オン/オフ切り替え
- `Button`: アクションボタン
- `Card`: セクション区切り
- `FormControl`: フォーム管理

### アイコン（MaterialIcons）
- 戻る: `arrow-back`
- カテゴリ: `category`
- 目標: `flag`
- 時間: `schedule`
- 通知: `notifications`

## ⚙️ 機能仕様

### データ型定義
```typescript
interface GoalFormData {
  title: string;                    // 目標タイトル
  description: string;              // 目標説明
  reminderEnabled: boolean;         // リマインダー有無
  reminderTime: string;             // リマインダー時刻 (例: "07:00")
}

interface TimeSlot {
  value: string;                    // 時刻文字列 (例: "07:00")
  label: string;                    // 表示用ラベル (例: "午前 7:00")
}
```

### バリデーション
```typescript
const validation = {
  title: {
    required: true,
    minLength: 1,
    maxLength: 50,
    message: 'タイトルは1文字以上50文字以内で入力してください'
  },
  description: {
    required: true,
    minLength: 1,
    maxLength: 200,
    message: '説明は1文字以上200文字以内で入力してください'
  }
}
```

### 状態管理
```typescript
const [currentStep, setCurrentStep] = useState(1);
const [formData, setFormData] = useState<GoalFormData>(initialFormData);
const [errors, setErrors] = useState<Record<string, string>>({});
const [isSubmitting, setIsSubmitting] = useState(false);
const [timeSlots, setTimeSlots] = useState<TimeSlot[]>([]);
```

## 🔧 技術仕様

### Hooks使用
- `useGoals`: 目標データの操作
- `useTrainer`: 現在のトレーナー情報
- `useToast`: 成功/エラーメッセージ表示
- `useColorModeValue`: ダークモード対応

### 主要関数

#### `validateStep(step: number): boolean`
- **目的**: 現在のステップのバリデーション
- **戻り値**: バリデーション成功の真偽値
- **処理**: ステップ1はタイトルと説明、ステップ2はバリデーション不要

#### `handleNext()`
- **目的**: 次のステップへの遷移処理
- **処理**:
  1. 現在のステップのバリデーション
  2. ステップ2への遷移

#### `handleCreateGoal()`
- **目的**: 目標作成処理の実行
- **処理**:
  1. 目標データの作成
  2. リマインダー設定の保存
  3. 成功メッセージ表示
  4. ダッシュボードへの遷移
  5. フォームデータのリセット

#### `generateTimeSlots()`
- **目的**: リマインダー時刻選択肢の生成
- **処理**: 6:00-22:30の30分間隔でTimeSlot配列を生成

#### `resetForm()`
- **目的**: フォーム状態のリセット
- **処理**: 全フォームデータを初期状態に戻す

## 📱 インタラクション

### 操作フロー
1. **基本情報入力** → タイトルと説明を入力
2. **次へボタンタップ** → バリデーション後にステップ2へ遷移
3. **リマインダー設定** → 有効/無効の切り替えと時刻選択
4. **目標作成** → ボタンタップで目標作成完了
5. **ダッシュボード遷移** → 作成成功後に自動遷移

### フィードバック
- **リアルタイムバリデーション**: 入力時のエラー表示
- **ハプティック**: ボタンタップ時の触覚フィードバック
- **トースト通知**: 作成成功/失敗メッセージ
- **ローディング**: 送信中の状態表示

### アクセシビリティ
- **音声読み上げ**: 各フィールドのラベル設定
- **キーボードナビゲーション**: タブ順序の最適化
- **コントラスト**: 十分な色彩コントラスト確保
- **文字サイズ**: システム文字サイズ設定に対応

## 🚨 エラーハンドリング

### バリデーションエラー
- **必須フィールド未入力**: 赤枠表示とエラーメッセージ
- **文字数制限**: リアルタイムでカウント表示
- **不正な日付**: 日付選択時の制限チェック

### システムエラー
- **データベースエラー**: エラートースト表示
- **ネットワークエラー**: 再試行オプション提供
- **バリデーションエラー**: 該当フィールドのハイライト

## 🔄 ライフサイクル

### 画面遷移
- **ステップ1画面** → 基本情報の入力・編集
- **ステップ2画面** → リマインダー設定
- **完了** → 作成成功後、ダッシュボードへ自動遷移

### データ永続化
- **作成完了**: WatermelonDBへの永続保存
- **キャッシュ**: 作成後のデータキャッシュ更新
- **フォームリセット**: 作成成功後の状態初期化

## 🚀 実装ファイル

- **メインコンポーネント**: `src/screens/SimpleGoalCreation.tsx`
- **型定義**: `src/types/Goal.ts`
- **データモデル**: `src/database/models/Goal.ts`
- **Hooks**: `src/hooks/useGoals.ts`

## 📋 テスト観点

### 単体テスト
- [ ] フォームバリデーション（タイトル・説明）
- [ ] ステップ遷移ロジック
- [ ] リマインダー時刻生成
- [ ] フォームリセット機能

### 統合テスト
- [ ] 2ステップ目標作成フロー
- [ ] WatermelonDB連携
- [ ] ダッシュボードへのナビゲーション
- [ ] トースト通知

### UIテスト
- [ ] ステップ1・2の表示切り替え
- [ ] リマインダートグルスイッチ
- [ ] 時刻選択ピッカー
- [ ] バリデーションエラー表示

### アクセシビリティテスト
- [ ] スクリーンリーダー対応
- [ ] キーボード操作
- [ ] 色覚異常対応
- [ ] 文字サイズ拡大対応

---

*📝 Created: 2025-08-20 | 🔄 Last Updated: 2025-09-04*