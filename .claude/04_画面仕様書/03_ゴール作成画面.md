# ゴール作成画面 設計書

## 📋 画面概要

### 目的
ユーザーが新しい習慣形成目標を作成・設定する画面。詳細な目標設定により、効果的な習慣形成をサポートする。

### 機能概要
- 目標の基本情報設定
- 動機・理由の記録
- 難易度設定
- 終了日設定（オプション）
- 日次アクション設定
- リマインダー設定

## 🎯 ユーザー体験

### ユーザーストーリー
```
ユーザーとして、
具体的で実現可能な習慣目標を設定したい。
そうすることで、継続しやすい習慣形成ができる。
```

### 主要なユースケース
1. **新規目標作成**: 初めての習慣目標を設定
2. **詳細設定**: 動機や難易度を細かく調整
3. **リマインダー設定**: 継続のための通知設定
4. **目標管理**: 終了日や日次アクションの計画

## 🏗 UI構造

### レイアウト構成
```
┌─────────────────────────┐
│        ヘッダー          │
├─────────────────────────┤
│                         │
│      基本情報セクション    │
│  ┌─────────────────┐   │
│  │ タイトル入力       │   │
│  │ カテゴリ選択       │   │
│  │ 目標説明入力       │   │
│  └─────────────────┘   │
│                         │
│      動機・設定セクション  │
│  ┌─────────────────┐   │
│  │ 動機入力           │   │
│  │ 難易度スライダー     │   │
│  │ 終了日設定         │   │
│  └─────────────────┘   │
│                         │
│    日次アクションセクション │
│  ┌─────────────────┐   │
│  │ アクション名       │   │
│  │ 説明             │   │
│  │ 所要時間         │   │
│  │ リマインダー       │   │
│  └─────────────────┘   │
│                         │
├─────────────────────────┤
│      [作成ボタン]        │
└─────────────────────────┘
```

### セクション構成

#### 1. ヘッダー
- **タイトル**: 「新しい目標を作成」
- **戻るボタン**: 前画面への戻り機能

#### 2. 基本情報セクション
- **タイトル入力**: 目標名（必須）
- **カテゴリ選択**: ドロップダウンで選択
  - 健康・フィットネス
  - 学習・スキル
  - 仕事・キャリア
  - 人間関係
  - 趣味・創作
  - その他
- **目標説明**: 詳細な説明（テキストエリア）

#### 3. 動機・設定セクション
- **動機入力**: なぜこの目標を達成したいか
- **難易度スライダー**: 1-5のスライダー
- **終了日設定**: 
  - スイッチで有効/無効切り替え
  - 日付ピッカーで選択

#### 4. 日次アクションセクション
- **アクション名**: 毎日行う具体的な行動
- **説明**: アクションの詳細
- **所要時間**: 分単位のスライダー
- **リマインダー設定**:
  - 有効/無効スイッチ
  - 時刻選択（時・分）

## 🎨 デザイン仕様

### カラーパレット
- **プライマリ**: #007AFF（iOS標準ブルー）
- **セカンダリ**: #34C759（成功・完了）
- **アクセント**: #FF9500（警告・重要）
- **背景**: システム背景色（ライト/ダークモード対応）
- **テキスト**: システムテキスト色

### コンポーネントライブラリ（NativeBase）
- `Box`: レイアウトコンテナ
- `VStack/HStack`: 縦横配置
- `Input/TextArea`: テキスト入力
- `Select`: ドロップダウン選択
- `Slider`: 数値スライダー
- `Switch`: オン/オフ切り替え
- `Button`: アクションボタン
- `Card`: セクション区切り
- `FormControl`: フォーム管理

### アイコン（MaterialIcons）
- 戻る: `arrow-back`
- カテゴリ: `category`
- 目標: `flag`
- 時間: `schedule`
- 通知: `notifications`

## ⚙️ 機能仕様

### データ型定義
```typescript
interface GoalFormData {
  title: string;                    // 目標タイトル
  category: string;                 // カテゴリ
  targetDescription: string;        // 目標説明
  motivation: string;               // 動機
  difficulty: GoalDifficulty;       // 難易度(1-5)
  hasEndDate: boolean;              // 終了日設定有無
  targetEndDate?: Date;             // 終了日
  dailyActionTitle: string;         // 日次アクション名
  dailyActionDescription: string;   // 日次アクション説明
  estimatedMinutes: number;         // 所要時間(分)
  hasReminder: boolean;             // リマインダー有無
  reminderHour?: number;            // リマインダー時
  reminderMinute?: number;          // リマインダー分
}
```

### バリデーション
```typescript
const validation = {
  title: {
    required: true,
    minLength: 1,
    maxLength: 50
  },
  category: {
    required: true
  },
  targetDescription: {
    required: true,
    minLength: 10,
    maxLength: 500
  },
  motivation: {
    required: true,
    minLength: 10,
    maxLength: 300
  },
  dailyActionTitle: {
    required: true,
    minLength: 1,
    maxLength: 50
  }
}
```

### 状態管理
```typescript
const [formData, setFormData] = useState<GoalFormData>(initialFormData);
const [errors, setErrors] = useState<Record<string, string>>({});
const [isSubmitting, setIsSubmitting] = useState(false);
const [showDatePicker, setShowDatePicker] = useState(false);
const [showTimePicker, setShowTimePicker] = useState(false);
```

## 🔧 技術仕様

### Hooks使用
- `useGoals`: 目標データの操作
- `useTrainer`: 現在のトレーナー情報
- `useToast`: 成功/エラーメッセージ表示
- `useColorModeValue`: ダークモード対応

### 主要関数

#### `validateForm(): boolean`
- **目的**: フォーム全体のバリデーション
- **戻り値**: バリデーション成功の真偽値
- **処理**: 各フィールドの必須チェック、文字数制限確認

#### `handleSubmit()`
- **目的**: 目標作成処理の実行
- **処理**:
  1. フォームバリデーション
  2. 目標データの作成
  3. 日次アクションの作成
  4. 成功メッセージ表示
  5. 前画面への戻り

#### `updateFormField(field: string, value: any)`
- **目的**: フォームフィールドの更新
- **処理**: 指定フィールドの値を更新、エラー状態をクリア

#### `handleDateChange(date: Date)`
- **目的**: 日付選択の処理
- **処理**: 選択された日付をフォームデータに反映

## 📱 インタラクション

### 操作フロー
1. **基本情報入力** → タイトル、カテゴリ、説明を入力
2. **動機設定** → 目標への動機を記述
3. **難易度調整** → スライダーで難易度選択
4. **期限設定** → 必要に応じて終了日を設定
5. **日次アクション** → 毎日の具体的行動を定義
6. **リマインダー** → 通知設定を調整
7. **作成実行** → フォーム送信で目標作成

### フィードバック
- **リアルタイムバリデーション**: 入力時のエラー表示
- **ハプティック**: ボタンタップ時の触覚フィードバック
- **トースト通知**: 作成成功/失敗メッセージ
- **ローディング**: 送信中の状態表示

### アクセシビリティ
- **音声読み上げ**: 各フィールドのラベル設定
- **キーボードナビゲーション**: タブ順序の最適化
- **コントラスト**: 十分な色彩コントラスト確保
- **文字サイズ**: システム文字サイズ設定に対応

## 🚨 エラーハンドリング

### バリデーションエラー
- **必須フィールド未入力**: 赤枠表示とエラーメッセージ
- **文字数制限**: リアルタイムでカウント表示
- **不正な日付**: 日付選択時の制限チェック

### システムエラー
- **データベースエラー**: エラートースト表示
- **ネットワークエラー**: 再試行オプション提供
- **バリデーションエラー**: 該当フィールドのハイライト

## 🔄 ライフサイクル

### 画面遷移
- **入力画面** → フォーム表示・編集
- **確認画面** → データ検証・プレビュー（将来実装）
- **完了画面** → 作成成功、ダッシュボードへ戻る

### データ永続化
- **一時保存**: フォーム離脱時の下書き保存（将来実装）
- **作成完了**: データベースへの永続保存
- **キャッシュ**: 作成後のデータキャッシュ更新

## 🚀 実装ファイル

- **メインコンポーネント**: `src/screens/GoalCreationScreen.tsx`
- **型定義**: `src/types/Goal.ts`
- **データモデル**: `src/database/models/Goal.ts`
- **Hooks**: `src/hooks/useGoals.ts`

## 📋 テスト観点

### 単体テスト
- [ ] フォームバリデーション
- [ ] データ型変換
- [ ] エラーハンドリング
- [ ] 日付・時刻処理

### 統合テスト
- [ ] 目標作成フロー
- [ ] データベース連携
- [ ] ナビゲーション
- [ ] トースト通知

### UIテスト
- [ ] 全フィールドの表示・入力
- [ ] バリデーションエラー表示
- [ ] 日付・時刻ピッカー
- [ ] レスポンシブレイアウト

### アクセシビリティテスト
- [ ] スクリーンリーダー対応
- [ ] キーボード操作
- [ ] 色覚異常対応
- [ ] 文字サイズ拡大対応

---

*📝 Created: 2025-08-20 | 🔄 Last Updated: 2025-08-20*